1. Protect fprintf
2. Replace double with float
